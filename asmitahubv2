--// üî∞ Rayfield Loader
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Services (single declaration to avoid shadowing)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

--// ü™Ñ Create Window
local Window = Rayfield:CreateWindow({
	Name = "asmita Script Hub | Adventure Game",
	LoadingTitle = "Loading asmita Hub üí•",
	LoadingSubtitle = "by amrr",
	ConfigurationSaving = {
		Enabled = false,
		FolderName = nil,
		FileName = "asmita Hub"
	},
	Discord = {
		Enabled = false,
		Invite = "noinvitelink",
		RememberJoins = true
	},
	-- NOTE: set KeySystem = false agar GUI langsung muncul. Jika ingin pakai key system, kembalikan ke true dan atur KeySettings.
	KeySystem = false,
	KeySettings = {
		Title = "asmita Hub Key",
		Subtitle = "Key System",
		Note = "Key ada di server Discord",
		FileName = "asmitaHubKey1",
		SaveKey = false,
		GrabKeyFromSite = false,
		Key = {"240424"}
	}
})

-----------------------------------------------------------
-- üè† MAIN TAB
-----------------------------------------------------------
-- Added icon ids for tabs to ensure visibility in Rayfield
local MainTab = Window:CreateTab("üè† Home", 13047715178)

Rayfield:Notify({
	Title = "asmita Hub Loaded! ‚úÖ",
	Content = "GUI berhasil dijalankan!",
	Duration = 5,
	Image = 13047715178,
})

-- ü™Ç Infinite Jump
MainTab:CreateButton({
	Name = "ü™Ç Infinite Jump Toggle",
	Callback = function()
		_G.infinjump = not _G.infinjump

		if _G.infinJumpStarted == nil then
			_G.infinJumpStarted = true
			local plr = Players.LocalPlayer
			local m = plr:GetMouse()
			m.KeyDown:Connect(function(k)
				-- safe check dan cuma tangani space
				if _G.infinjump and k:byte() == 32 then
					local char = plr.Character
					if char then
						local humanoid = char:FindFirstChildOfClass('Humanoid')
						if humanoid then
							humanoid:ChangeState('Jumping')
							task.wait()
							-- fallback agar tidak tetap di seated
							pcall(function() humanoid:ChangeState('Seated') end)
						end
					end
				end
			end)
		end
	end,
})

-- üèÉ WalkSpeed Slider
MainTab:CreateSlider({
	Name = "üèÉ WalkSpeed",
	Range = {16, 300},
	Increment = 1,
	Suffix = "Speed",
	CurrentValue = 16,
	Callback = function(Value)
		local char = Players.LocalPlayer.Character
		if char and char:FindFirstChildOfClass("Humanoid") then
			char:FindFirstChildOfClass("Humanoid").WalkSpeed = Value
		end
	end,
})

-- ü¶ò JumpPower Slider
MainTab:CreateSlider({
	Name = "ü¶ò JumpPower",
	Range = {16, 300},
	Increment = 1,
	Suffix = "Power",
	CurrentValue = 50,
	Callback = function(Value)
		local char = Players.LocalPlayer.Character
		if char and char:FindFirstChildOfClass("Humanoid") then
			char:FindFirstChildOfClass("Humanoid").JumpPower = Value
		end
	end,
})

-----------------------------------------------------------
-- üèù TELEPORT TAB (CP0 - CP15)
-----------------------------------------------------------
local TPTab = Window:CreateTab("üèù Teleports", 4483362458)
local player = Players.LocalPlayer

-- Fungsi aman untuk mengambil checkpoint
local function getCheckpoint(name)
	local success, result = pcall(function()
		local cps = Workspace:FindFirstChild("Checkpoints")
		if cps then
			return cps:FindFirstChild(name)
		else
			-- fallback: cari langsung di workspace path yang sering dipakai
			return Workspace:FindFirstChild(name)
		end
	end)
	return success and result or nil
end

-- Buat semua checkpoint CP0 sampai CP15
local checkpoints = {}
for i = 0, 15 do
	checkpoints[i] = getCheckpoint("CP" .. i)
end

-- Fungsi teleport
local function teleportTo(target, name)
	if not target then
		Rayfield:Notify({
			Title = "‚ö†Ô∏è Gagal Teleport",
			Content = name .. " tidak ditemukan di workspace!",
			Duration = 3,
		})
		return
	end
	local char = player.Character or player.CharacterAdded:Wait()
	local hrp = char:FindFirstChild("HumanoidRootPart") or char:WaitForChild("HumanoidRootPart")
	hrp.CFrame = target.CFrame + Vector3.new(0, 3, 0)
	Rayfield:Notify({
		Title = "‚úÖ Teleport Berhasil!",
		Content = "Kamu berpindah ke " .. name .. " üèù",
		Duration = 3,
	})
end

-- Tambahkan tombol teleport untuk CP0‚ÄìCP15
for i = 0, 15 do
	local idx = i
	TPTab:CreateButton({
		Name = "üö© Checkpoint CP" .. idx,
		Callback = function()
			teleportTo(checkpoints[idx], "CP" .. idx)
		end,
	})
end

-----------------------------------------------------------
-- ü™Ω FLY TAB (PC & MOBILE COMPATIBLE)
-----------------------------------------------------------
local FlyTab = Window:CreateTab("ü™Ω Fly", 4583362458)
local flying = false
local flySpeed = 60
local flyConn = nil
local bodyVel, bodyGyro

-- Variabel kontrol mobile
local moveForward = false
local moveBackward = false
local moveLeft = false
local moveRight = false
local moveUp = false
local moveDown = false

-- Deteksi platform
local isMobile = UIS.TouchEnabled and not UIS.KeyboardEnabled

local function stopFly(char)
	local hrp = char and char:FindFirstChild("HumanoidRootPart")
	if hrp then
		if bodyVel then bodyVel:Destroy() bodyVel = nil end
		if bodyGyro then bodyGyro:Destroy() bodyGyro = nil end
	end
	if flyConn then flyConn:Disconnect() flyConn = nil end

	local humanoid = char and char:FindFirstChildOfClass("Humanoid")
	if humanoid then
		humanoid.PlatformStand = false
		pcall(function() humanoid:ChangeState(Enum.HumanoidStateType.Running) end)
	end
	
	-- Reset kontrol mobile
	moveForward = false
	moveBackward = false
	moveLeft = false
	moveRight = false
	moveUp = false
	moveDown = false
end

local function startFly()
	local player = Players.LocalPlayer
	local char = player.Character or player.CharacterAdded:Wait()
	local hrp = char:WaitForChild("HumanoidRootPart")
	local humanoid = char:WaitForChild("Humanoid")

	humanoid.PlatformStand = true

	bodyVel = Instance.new("BodyVelocity")
	bodyVel.MaxForce = Vector3.new(9e9, 9e9, 9e9)
	bodyVel.Velocity = Vector3.zero
	bodyVel.Parent = hrp

	bodyGyro = Instance.new("BodyGyro")
	bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
	bodyGyro.P = 9e4
	bodyGyro.CFrame = hrp.CFrame
	bodyGyro.Parent = hrp

	flyConn = RunService.RenderStepped:Connect(function()
		if not flying then return end

		local camCF = Workspace.CurrentCamera.CFrame
		local moveDir = Vector3.zero

		-- Kontrol PC (Keyboard)
		if UIS:IsKeyDown(Enum.KeyCode.W) or moveForward then 
			moveDir += camCF.LookVector 
		end
		if UIS:IsKeyDown(Enum.KeyCode.S) or moveBackward then 
			moveDir -= camCF.LookVector 
		end
		if UIS:IsKeyDown(Enum.KeyCode.A) or moveLeft then 
			moveDir -= camCF.RightVector 
		end
		if UIS:IsKeyDown(Enum.KeyCode.D) or moveRight then 
			moveDir += camCF.RightVector 
		end
		if UIS:IsKeyDown(Enum.KeyCode.Space) or moveUp then 
			moveDir += Vector3.new(0, 1, 0) 
		end
		if UIS:IsKeyDown(Enum.KeyCode.LeftControl) or moveDown then 
			moveDir -= Vector3.new(0, 1, 0) 
		end

		if moveDir.Magnitude > 0 then
			bodyVel.Velocity = moveDir.Unit * flySpeed
		else
			bodyVel.Velocity = Vector3.zero
		end
		bodyGyro.CFrame = camCF
	end)
end

-- Fungsi untuk membuat GUI kontrol mobile
local function createMobileControls()
	local playerGui = Players.LocalPlayer:WaitForChild("PlayerGui")
	
	-- Cek jika sudah ada GUI
	if playerGui:FindFirstChild("FlyControlsGUI") then
		return
	end
	
	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "FlyControlsGUI"
	screenGui.ResetOnSpawn = false
	screenGui.Parent = playerGui
	
	-- Fungsi untuk membuat tombol
	local function createButton(text, position, callback)
		local button = Instance.new("TextButton")
		button.Size = UDim2.new(0, 70, 0, 70)
		button.Position = position
		button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
		button.BackgroundTransparency = 0.3
		button.BorderSizePixel = 2
		button.BorderColor3 = Color3.fromRGB(255, 255, 255)
		button.Text = text
		button.TextColor3 = Color3.fromRGB(255, 255, 255)
		button.TextSize = 24
		button.Font = Enum.Font.GothamBold
		button.Parent = screenGui
		
		-- Rounded corners
		local corner = Instance.new("UICorner")
		corner.CornerRadius = UDim.new(0, 12)
		corner.Parent = button
		
		button.InputBegan:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.Touch then
				callback(true)
				button.BackgroundColor3 = Color3.fromRGB(80, 150, 255)
			end
		end)
		
		button.InputEnded:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.Touch then
				callback(false)
				button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
			end
		end)
		
		return button
	end
	
	-- Tombol arah
	createButton("‚ñ≤", UDim2.new(0, 20, 0.7, -80), function(pressed) moveForward = pressed end) -- W
	createButton("‚ñº", UDim2.new(0, 20, 0.7, 0), function(pressed) moveBackward = pressed end) -- S
	createButton("‚óÑ", UDim2.new(0, -60, 0.7, -40), function(pressed) moveLeft = pressed end) -- A
	createButton("‚ñ∫", UDim2.new(0, 100, 0.7, -40), function(pressed) moveRight = pressed end) -- D
	
	-- Tombol naik/turun
	createButton("‚ñ≤", UDim2.new(1, -90, 0.7, -80), function(pressed) moveUp = pressed end) -- Space
	createButton("‚ñº", UDim2.new(1, -90, 0.7, 0), function(pressed) moveDown = pressed end) -- Ctrl
	
	-- Label info
	local infoLabel = Instance.new("TextLabel")
	infoLabel.Size = UDim2.new(0, 200, 0, 30)
	infoLabel.Position = UDim2.new(0.5, -100, 0.7, -120)
	infoLabel.BackgroundTransparency = 1
	infoLabel.Text = "ü™Ω Fly Controls"
	infoLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	infoLabel.TextSize = 18
	infoLabel.Font = Enum.Font.GothamBold
	infoLabel.Parent = screenGui
end

-- Fungsi untuk menghapus GUI kontrol mobile
local function removeMobileControls()
	local playerGui = Players.LocalPlayer:WaitForChild("PlayerGui")
	local gui = playerGui:FindFirstChild("FlyControlsGUI")
	if gui then
		gui:Destroy()
	end
end

FlyTab:CreateButton({
	Name = "üïä Toggle Fly (On/Off)",
	Callback = function()
		local player = Players.LocalPlayer
		local char = player.Character or player.CharacterAdded:Wait()

		flying = not flying
		if flying then
			startFly()
			
			-- Tampilkan kontrol mobile jika di perangkat mobile
			if isMobile then
				createMobileControls()
			end
			
			local controls = isMobile and "Gunakan tombol on-screen untuk bergerak." or "Gunakan W, A, S, D untuk bergerak. Space = naik, Ctrl = turun."
			
			Rayfield:Notify({
				Title = "üïä Fly Aktif!",
				Content = controls,
				Duration = 4,
			})
		else
			stopFly(char)
			removeMobileControls()
			
			Rayfield:Notify({
				Title = "ü™∂ Fly Dimatikan",
				Content = "Kamu kembali berjalan normal.",
				Duration = 3,
			})
		end
	end,
})

FlyTab:CreateSlider({
	Name = "‚ö° Fly Speed",
	Range = {10, 200},
	Increment = 5,
	Suffix = "Speed",
	CurrentValue = 60,
	Callback = function(Value)
		flySpeed = Value
	end,
})

-- Info platform
FlyTab:CreateButton({
	Name = "‚ÑπÔ∏è Platform Info",
	Callback = function()
		local platform = isMobile and "üì± Mobile" or "üíª PC"
		Rayfield:Notify({
			Title = "Platform Detected",
			Content = "Kamu menggunakan: " .. platform,
			Duration = 3,
		})
	end,
})

-----------------------------------------------------------
-- üéØ CAMERA LOCK TAB (Focus & Teleport in One Tab)
-----------------------------------------------------------
local LockTab = Window:CreateTab("üéØ Camera Lock", 6337428166)

-- üîí Variabel utama
local lockEnabled = false
local lockTarget = nil
local lockConn = nil
local smoothness = 0.2

-- Simpan kamera asli (tidak digunakan saat ini, tapi disimpan jika butuh restore)
local Camera = Workspace.CurrentCamera
local originalType = Camera.CameraType
local originalSubject = Camera.CameraSubject

-----------------------------------------------------------
-- üîç Utility Functions
-----------------------------------------------------------

-- Ambil daftar nama pemain lain
local function getPlayerNames()
	local names = {}
	for _, p in pairs(Players:GetPlayers()) do
		if p ~= LocalPlayer then
			table.insert(names, p.Name)
		end
	end
	return names
end

-- Cari pemain dari nama
local function findPlayerByName(name)
	for _, p in pairs(Players:GetPlayers()) do
		if p.Name == name then
			return p
		end
	end
	return nil
end

-- Cari pemain terdekat
local function findNearestPlayer()
	local char = LocalPlayer.Character
	if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
	local myPos = char.HumanoidRootPart.Position
	local nearest, minDist = nil, math.huge

	for _, p in pairs(Players:GetPlayers()) do
		if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
			local dist = (p.Character.HumanoidRootPart.Position - myPos).Magnitude
			if dist < minDist then
				minDist = dist
				nearest = p
			end
		end
	end
	return nearest
end

-----------------------------------------------------------
-- üì∑ Core Camera Lock Function
-----------------------------------------------------------

local function resetCamera()
	-- Kembalikan kamera ke mode normal mengikuti player
	if Camera and Camera.Parent then
		Camera.CameraType = Enum.CameraType.Custom
		
		local char = LocalPlayer.Character
		if char then
			local humanoid = char:FindFirstChildOfClass("Humanoid")
			if humanoid then
				Camera.CameraSubject = humanoid
			end
		end
	end
end

local function stopLock()
	if lockConn then
		lockConn:Disconnect()
		lockConn = nil
	end

	lockEnabled = false
	lockTarget = nil

	-- Kembalikan kamera ke normal
	resetCamera()

	Rayfield:Notify({
		Title = "üéØ Lock Dimatikan",
		Content = "Kamera kembali normal.",
		Duration = 3,
	})
end

local function startLock(target)
	if not target or not target.Character then
		Rayfield:Notify({
			Title = "‚ùå Gagal",
			Content = "Target tidak ditemukan atau belum spawn.",
			Duration = 3,
		})
		return
	end

	lockTarget = target
	lockEnabled = true

	-- Set kamera jadi scriptable
	Camera.CameraType = Enum.CameraType.Scriptable

	Rayfield:Notify({
		Title = "üéØ Lock Aktif",
		Content = "Kamera fokus pada " .. target.Name,
		Duration = 3,
	})

	-- Smooth follow kamera
	lockConn = RunService.RenderStepped:Connect(function(dt)
		if not lockEnabled or not lockTarget or not lockTarget.Character then
			stopLock()
			return
		end

		local targetHead = lockTarget.Character:FindFirstChild("Head")
		if not targetHead then return end

		-- posisi target
		local targetPos = targetHead.Position + Vector3.new(0, 1, 0)

		-- posisi kamera (jarak tertentu di belakang & atas)
		local backOffset = Vector3.new(0, 4, 8)
		local desiredPos = targetHead.CFrame:ToWorldSpace(CFrame.new(backOffset)).p

		-- Smooth Lerp kamera
		local currentCF = Camera.CFrame
		local desiredCF = CFrame.new(desiredPos, targetPos)
		Camera.CFrame = currentCF:Lerp(desiredCF, math.clamp(dt * (1 / smoothness), 0, 1))
	end)
end

-----------------------------------------------------------
-- üéÆ Dropdown + UI Setup
-----------------------------------------------------------

local selectedName = nil
local dropdown = LockTab:CreateDropdown({
	Name = "üîé Pilih Pemain",
	Options = getPlayerNames(),
	CurrentOption = {},
	MultipleOptions = false,
	Callback = function(Option)
		selectedName = Option[1]
	end,
})

local function refreshDropdown()
	dropdown:Refresh(getPlayerNames())
end

Players.PlayerAdded:Connect(refreshDropdown)
Players.PlayerRemoving:Connect(refreshDropdown)

-----------------------------------------------------------
-- üß≠ Tombol Kontrol Lock Kamera
-----------------------------------------------------------

LockTab:CreateButton({
	Name = "üéØ Lock Player (Selected)",
	Callback = function()
		if lockEnabled then
			stopLock()
		else
			local p = findPlayerByName(selectedName)
			if p then
				startLock(p)
			else
				Rayfield:Notify({
					Title = "‚ùå Tidak Ditemukan",
					Content = "Pemain tidak valid atau belum dipilih.",
					Duration = 2,
				})
			end
		end
	end,
})

LockTab:CreateButton({
	Name = "üéØ Lock Nearest Player",
	Callback = function()
		if lockEnabled then
			stopLock()
		else
			local p = findNearestPlayer()
			if p then startLock(p)
			else
				Rayfield:Notify({
					Title = "‚ö†Ô∏è Tidak Ada Pemain",
					Content = "Tidak ada pemain lain di dekatmu.",
					Duration = 2,
				})
			end
		end
	end,
})

LockTab:CreateSlider({
	Name = "‚öôÔ∏è Smoothness",
	Range = {0.05, 1},
	Increment = 0.05,
	Suffix = "",
	CurrentValue = smoothness,
	Callback = function(Value)
		smoothness = Value
	end,
})

-----------------------------------------------------------
-- ‚ö° TELEPORT KE POSISI KAMERA (AUTO RESET KAMERA)
-----------------------------------------------------------

local function teleportToCamera()
	local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	local hrp = char:WaitForChild("HumanoidRootPart")

	local camCF = Camera.CFrame
	hrp.CFrame = camCF + camCF.LookVector * -2 + Vector3.new(0, 3, 0)

	-- ‚úÖ RESET KAMERA SETELAH TELEPORT
	if lockEnabled then
		stopLock()
	else
		resetCamera()
	end

	Rayfield:Notify({
		Title = "‚ö° Teleport Berhasil!",
		Content = "Kamu berpindah ke posisi kamera. Kamera kembali normal üéØ",
		Duration = 3,
	})
end

LockTab:CreateButton({
	Name = "‚ö° Teleport ke Posisi Kamera",
	Callback = teleportToCamera,
})

-----------------------------------------------------------
-- üîÑ Cleanup jika target hilang
-----------------------------------------------------------

LocalPlayer.CharacterRemoving:Connect(stopLock)
Players.PlayerRemoving:Connect(function(p)
	if lockTarget == p then
		stopLock()
	end
end)

print("[asmita Hub] üéØ Camera Lock Tab Loaded (Focus + Teleport Unified)")

-----------------------------------------------------------
-- üö´ NOCLIP TAB
-----------------------------------------------------------
local NoclipTab = Window:CreateTab("üö´ Noclip", 7218471280)

local noclipEnabled = false
local player = Players.LocalPlayer

-- Fungsi aktifkan Noclip
local function enableNoclip()
	noclipEnabled = true
	Rayfield:Notify({
		Title = "üö´ Noclip Aktif",
		Content = "Kamu sekarang bisa menembus dinding atau rintangan.",
		Duration = 4,
	})
end

-- Fungsi nonaktifkan Noclip
local function disableNoclip()
	noclipEnabled = false
	Rayfield:Notify({
		Title = "‚úÖ Noclip Dimatikan",
		Content = "Kamu kembali ke mode normal.",
		Duration = 3,
	})
end

-- Toggle button
NoclipTab:CreateButton({
	Name = "üîÄ Toggle Noclip (On/Off)",
	Callback = function()
		if noclipEnabled then
			disableNoclip()
		else
			enableNoclip()
		end
	end,
})

-- Loop Noclip
RunService.Stepped:Connect(function()
	if noclipEnabled then
		local char = player.Character
		if char then
			for _, part in ipairs(char:GetDescendants()) do
				if part:IsA("BasePart") and part.CanCollide == true then
					part.CanCollide = false
				end
			end
		end
	end
end)

-- Cleanup saat fly dimatikan
Players.LocalPlayer.CharacterRemoving:Connect(function()
	removeMobileControls()
end)

-----------------------------------------------------------
print("[asmita Hub] ‚úÖ Loaded successfully - PC & Mobile Compatible!")
